<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<ui:composition>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#{request.contextPath}/pages/index.xhtml">Taxi driver</a>
            </div>

            <div class="navbar-collapse collapse">
                <h:form>

                    <ul class="nav navbar-nav navbar-right">
                        <li><h:commandLink value="Logout" action="#{navRule.logout()}"/></li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li><p:commandLink type="button" value="Edit profile" onclick="PF('userEdit2').show()"/></li>
                        <li><p:commandLink type="button" value="Change password" onclick="PF('userPassChange').show()"/>
                        </li>
                    </ul>
                </h:form>
                <f:metadata>
                    <f:event type="preRenderView" listener="#{userMB.setActiveUser()}"/>
                </f:metadata>

                <p:dialog header="User Edit" widgetVar="userEdit2" modal="true" showEffect="fade" hideEffect="fade"
                          resizable="false">
                    <p:outputPanel id="userEdit2" style="text-align:center;">
                        <h:form>
                            <p:panelGrid columns="2" rendered="true"
                                         columnClasses="value,value">
                                <p:column>
                                    <h:outputText value="Login"/>
                                </p:column>
                                <p:column>
                                    <p:inputText id="login" value="#{userMB.activeUser.login}" required="true"
                                                 disabled="true">
                                    </p:inputText>
                                    <p:message id="loginMsg" for="login" display="icon"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="Name"/>
                                </p:column>
                                <p:column>
                                    <p:inputText id="name" value="#{userMB.activeUser.name}" disabled="true"
                                                 required="true">
                                        <f:validateLength minimum="3"/>
                                        <p:ajax event="blur" update="nameMsg"/>
                                    </p:inputText>
                                    <p:message id="nameMsg" for="name" display="icon"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="Last name"/>
                                </p:column>
                                <p:column>
                                    <p:inputText id="lastName" value="#{userMB.activeUser.lastName}" disabled="true"
                                                 required="true">
                                        <f:validateLength minimum="3"/>
                                        <p:ajax event="blur" update="lastNameMsg"/>
                                    </p:inputText>
                                    <p:message id="lastNameMsg" for="lastName" display="icon"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="Phone"/>
                                </p:column>
                                <p:column>
                                    <p:inputText id="phone" value="#{userMB.activeUser.phone}" required="true">
                                        <f:validateLength minimum="6"/>
                                        <p:ajax event="blur" update="phoneMsg"/>
                                    </p:inputText>
                                    <p:message id="phoneMsg" for="phone" display="icon"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="Date of birthday"/>
                                </p:column>
                                <p:column>
                                    <p:calendar id="dobEdit" value="#{userMB.activeUser.dob}" required="true"
                                                disabled="true"
                                                requiredMessage="Pick valid date" navigator="true" pattern="dd.MM.yyyy"
                                                styleClass="dobClass"/>
                                </p:column>

                                <p:commandButton id="addUser" value="Update" action="#{userMB.editProfile()}"
                                                 ajax="false"/>
                                <p:commandButton id="cancel" value="Cancel" onclick="PF('userEdit').close()"
                                                 ajax="false"/>
                            </p:panelGrid>
                        </h:form>
                    </p:outputPanel>
                </p:dialog>

                <p:dialog header="Change password" widgetVar="userPassChange" modal="true" showEffect="fade"
                          hideEffect="fade"
                          resizable="false">
                    <p:outputPanel id="userPassChange" style="text-align:center;">
                        <h:form>
                            <div style="z-index: 99999!important;left: 50%!important; top: 50%!important;">
                                <p:growl id="acceptedMessage" showDetail="true"></p:growl>
                                <p:growl id="refusedMessage" showDetail="true"></p:growl>
                            </div>
                            <p:panelGrid columns="2" rendered="true"
                                         columnClasses="value,value">
                                <p:column>
                                    <h:outputText value="Login"/>
                                </p:column>
                                <p:column>
                                    <p:inputText id="loginP" value="#{userMB.activeUser.login}" required="true"
                                                 disabled="true">
                                    </p:inputText>
                                </p:column>
                                <p:column>
                                    <h:outputText value="Old password"/>
                                </p:column>
                                <p:column>
                                    <p:inputText id="password" type="password" placeholder="Old Password" value="#{userMB.oldPassword}"
                                                 required="true" validatorMessage="Minimum 5 cahracters.">
                                        <f:validateLength minimum="5"/>
                                        <p:ajax event="blur" update="passwordOldMsg"/>
                                    </p:inputText>
                                    <p:message id="passwordOldMsg" for="password" display="icon"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="New password"/>
                                </p:column>
                                <p:column>
                                    <p:inputText id="passwordNew" type="password" placeholder="New password"
                                                 value="#{userMB.newPassword}" required="true"
                                                 validatorMessage="Minimum 5 cahracters.">
                                        <f:validateLength minimum="5"/>
                                        <p:ajax event="blur" update="passwordNewMsg"/>
                                    </p:inputText>
                                    <p:message id="passwordNewMsg" for="passwordNew" display="icon"/>
                                </p:column>
                                <p:column>
                                    <h:outputText value="Repeat new password"/>
                                </p:column>
                                <p:column>
                                    <p:inputText id="passwordNew2" type="password" placeholder="Repeat new password"
                                                 value="#{userMB.newPasswordRepeated}" required="true"
                                                 validatorMessage="Minimum 5 cahracters.">
                                        <f:validateLength minimum="5"/>
                                        <p:ajax event="blur" update="passwordNew2Msg"/>
                                    </p:inputText>
                                    <p:message id="passwordNew2Msg" for="passwordNew2" display="icon"/>
                                </p:column>


                                <p:commandButton id="changePass" value="Update" action="#{userMB.chnageUserPassword()}"
                                                 ajax="false"/>
                                <p:commandButton id="cancelPassChange" value="Cancel"
                                                 onclick="PF('userPassChange').close()"
                                                 ajax="false"/>
                            </p:panelGrid>
                        </h:form>
                    </p:outputPanel>
                </p:dialog>

            </div>
        </div>
    </div>
</ui:composition>
</html>