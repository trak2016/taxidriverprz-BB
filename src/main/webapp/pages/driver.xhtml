<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
    <title>Hello WebSocket</title>
    <script type="text/javascript" src="../js/sockjs-0.3.4.js"></script>
    <script type="text/javascript" src="../js/stomp.js"></script>
    <script type="text/javascript">

        var userLoggedName = null;
        var clientPhone = null;

        function setConnected(connected) {
            document.getElementById('connect').disabled = connected;
            document.getElementById('disconnect').disabled = !connected;
//            document.getElementById('conversationDiv').style.visibility = connected ? 'visible' : 'hidden';
//            document.getElementById('response').innerHTML = '';
        }

        function connect() {
            var socket = new SockJS('/TaxiDriver/addcourse');
            stompClient = Stomp.over(socket);
            stompClient.connect({}, function(frame) {
                userLoggedName = frame.headers['user-name'];
                setConnected(true);
                console.log('Connected: ' + frame);
                stompClient.subscribe('/user/topic/notification', function(greeting){
//                    showGreeting(JSON.parse(greeting.body).content);
                    notify(greeting)
                });
            });
        }

        function disconnect() {
            if (stompClient != null) {
                stompClient.disconnect();
            }
            setConnected(false);
            console.log("Disconnected");
        }

        function sendConfirmation() {
            var status = true;
            stompClient.send("/app/notificationResponse", {}, JSON.stringify({
                'status': status,
                'user': userLoggedName,
                'clientPhone': clientPhone
            }));
        }

/*        function showGreeting(message) {
            var response = document.getElementById('response');
            var p = document.createElement('p');
            p.style.wordWrap = 'break-word';
            p.appendChild(document.createTextNode(message));
            response.appendChild(p);
        }*/

        function notify(notifyMessage){
            clientPhone = JSON.parse(notifyMessage.body).clientPhone;
            document.getElementById('messages').innerHTML
                    += '<br />' + 'Adres: ' + JSON.parse(notifyMessage.body).clientAddress + '  Telefon: ' + JSON.parse(notifyMessage.body).clientPhone;
            document.getElementById('responseDiv').style.visibility = "visible";
        }

        function showResponseDiv(){
            document.getElementById('responseDiv').style.visibility = "hidden";
            document.getElementById('responseDiv').innerHTML = '';
        }
//        set.timeout("showResponseDiv()", 5000);
    </script>
</head>
<body onload="disconnect()">
<noscript><h2 style="color: #ff0000">Seems your browser doesn't support Javascript! Websocket relies on Javascript being enabled. Please enable
    Javascript and reload this page!</h2></noscript>
<div>
    <div>
        <button id="connect" onclick="connect();">Connect</button>
        <button id="disconnect" disabled="disabled" onclick="disconnect();">Disconnect</button>
    </div>
<!--    <div id="conversationDiv">
        <label>sendConfirmation?</label>
        <button id="sendConfirmation" onclick="sendConfirmation();">Send Confirmation</button>
        <p id="response"></p>
    </div>-->

    <div id="responseDiv" style="visibility: hidden;">
        <label>Do you want take this course?</label>
        <button onclick="sendConfirmation();">Send Confirmation</button>
    </div>
    <div id="messages"></div>
</div>
</body>
</html>